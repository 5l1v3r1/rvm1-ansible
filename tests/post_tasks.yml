---
post_tasks:
  - name: Check that ruby exists
    command: ruby -v
    register: check_ruby
  - assert:
      that:
        - "check_ruby == 'ruby'"
        - "check_ruby.rc == 0 "
      msg: No ruby test pass

  - name: Check default ruby
    shell: ~/.rvm/wrappers/default/ruby -v | cut -c1-10
    register: check_ruby_default
  - assert:
      that:
        - "check_ruby_default.stdout == 'ruby 2.3.1'"
      msg: Default ruby test pass

  - name: Check multiple rubies
    command: ls ~/.rvm/rubies
    register: check_ruby_multiple
  - assert:
      that:
        - "ruby-2.2.5' in check_ruby_multiple.stdout"
        - "ruby-2.3.1' in check_ruby_multiple.stdout"
      msg: Multiple rubies test pass

  - name: Check bundler symlinked on system path
    shell: ls ~/.rvm/wrappers/default/ |grep 'bundler'
    register: check_ruby_bundler
  - assert:
      that:
        - "check_ruby_bundler.stdout == 'bundler' "
      msg: Bundler symlinked on system path test pass
